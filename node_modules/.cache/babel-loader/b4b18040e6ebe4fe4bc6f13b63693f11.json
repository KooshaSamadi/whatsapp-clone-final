{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Koosha\\\\Desktop\\\\Reed Barger - Build WhatsApp with React 2021-5\\\\whatsapp-clone\\\\src\\\\components\\\\ChatFooter.js\",\n    _s = $RefreshSig$();\n\nimport { CancelRounded, CheckCircleRounded, MicRounded, Send } from \"@material-ui/icons\";\nimport React from \"react\";\nimport { createTimestamp, db, audioStorage } from \"../firebase\";\nimport { v4 as uuid } from \"uuid\";\nimport \"./ChatFooter.css\";\nimport recordAudio from \"./recordAudio\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ChatFooter({\n  input,\n  onChange,\n  sendMessage,\n  image,\n  user,\n  room,\n  roomId,\n  setAudioId\n}) {\n  _s();\n\n  const [isRecording, setRecording] = React.useState(false);\n  const [duration, setDuration] = React.useState(\"00:00\");\n  const timerInterval = React.useRef();\n  const recordingEl = React.useRef();\n  const record = React.useRef();\n  const inputRef = React.useRef();\n\n  async function startRecording(event) {\n    event.preventDefault();\n    record.current = await recordAudio();\n    inputRef.current.focus();\n    inputRef.current.style.width = \"calc(100% - 56px)\";\n    setRecording(true);\n    setAudioId(\"\");\n  }\n\n  React.useEffect(() => {\n    if (isRecording) {\n      recordingEl.current.style.opacity = \"1\";\n      startTimer();\n      record.current.start();\n    }\n\n    function startTimer() {\n      const start = Date.now();\n      timerInterval.current = setInterval(setTime, 100);\n\n      function setTime() {\n        const timeElapsed = Date.now() - start;\n        const totalSeconds = Math.floor(timeElapsed / 1000);\n        const minutes = pad(parseInt(totalSeconds / 60));\n        const seconds = pad(parseInt(totalSeconds % 60));\n        const duration = `${minutes}:${seconds}`;\n        setDuration(duration);\n      }\n    }\n  }, [isRecording]);\n\n  function pad(value) {\n    return String(value).length < 2 ? `0${value}` : value;\n  }\n\n  async function stopRecording() {\n    inputRef.current.focus();\n    clearInterval(timerInterval.current);\n    const audio = record.current.stop();\n    recordingEl.current.style.opacity = \"0\";\n    setRecording(false);\n    inputRef.current.style.width = \"calc(100% - 112px)\";\n    setDuration(\"00:00\");\n    return audio;\n  }\n\n  async function finishRecording() {\n    const audio = await stopRecording();\n    const {\n      audioFile,\n      audioName\n    } = await audio;\n    sendAudio(audioFile, audioName);\n  }\n\n  async function sendAudio(audioFile, audioName) {\n    db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomId).set({\n      name: room.name,\n      photoURL: room.photoURL || null,\n      timestamp: createTimestamp()\n    });\n    const doc = await db.collection(\"rooms\").doc(roomId).collection(\"messages\").add({\n      name: user.displayName,\n      uid: user.uid,\n      timestamp: createTimestamp(),\n      time: new Date().toUTCString(),\n      audioUrl: \"uploading\",\n      audioName\n    });\n    await audioStorage.child(audioName).put(audioFile);\n    const url = await audioStorage.child(audioName).getDownloadURL();\n    db.collection(\"rooms\").doc(roomId).collection(\"messages\").doc(doc.id).update({\n      audioUrl: url\n    });\n  }\n\n  function audioInputChange(event) {\n    const audioFile = event.target.files[0];\n\n    if (audioFile) {\n      setAudioId(\"\");\n      sendAudio(audioFile, uuid());\n    }\n  }\n\n  const btnIcons = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Send, {\n      style: {\n        width: 20,\n        height: 20,\n        color: \"white\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MicRounded, {\n      style: {\n        width: 24,\n        height: 24,\n        color: \"white\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  const canRecord = navigator.mediaDevices.getUserMedia && window.MediaRecorder;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat__footer\",\n    children: [/*#__PURE__*/_jsxDEV(\"form\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        ref: inputRef,\n        value: input,\n        onChange: !isRecording ? onChange : null,\n        onKeyPress: isRecording ? () => false : null,\n        placeholder: \"Type a message\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this), canRecord ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: input.trim() || input === \"\" && image ? sendMessage : startRecording,\n        type: \"submit\",\n        className: \"send__btn\",\n        children: btnIcons\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"capture\",\n          className: \"send__btn\",\n          children: btnIcons\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: {\n            display: \"none\"\n          },\n          type: \"file\",\n          id: \"capture\",\n          accept: \"audio/*\",\n          capture: true,\n          onChange: audioInputChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this), isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: recordingEl,\n      className: \"record\",\n      children: [/*#__PURE__*/_jsxDEV(CancelRounded, {\n        style: {\n          width: 30,\n          height: 30,\n          color: \"#f20519\"\n        },\n        onClick: stopRecording\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"record__redcircle\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"record__duration\",\n          children: duration\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(CheckCircleRounded, {\n        style: {\n          width: 30,\n          height: 30,\n          color: \"#41bf49\"\n        },\n        onClick: finishRecording\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 149,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ChatFooter, \"4ATEXQEkyNOjF5apj9dQdYmFg9c=\");\n\n_c = ChatFooter;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatFooter\");","map":{"version":3,"sources":["C:/Users/Koosha/Desktop/Reed Barger - Build WhatsApp with React 2021-5/whatsapp-clone/src/components/ChatFooter.js"],"names":["CancelRounded","CheckCircleRounded","MicRounded","Send","React","createTimestamp","db","audioStorage","v4","uuid","recordAudio","ChatFooter","input","onChange","sendMessage","image","user","room","roomId","setAudioId","isRecording","setRecording","useState","duration","setDuration","timerInterval","useRef","recordingEl","record","inputRef","startRecording","event","preventDefault","current","focus","style","width","useEffect","opacity","startTimer","start","Date","now","setInterval","setTime","timeElapsed","totalSeconds","Math","floor","minutes","pad","parseInt","seconds","value","String","length","stopRecording","clearInterval","audio","stop","finishRecording","audioFile","audioName","sendAudio","collection","doc","uid","set","name","photoURL","timestamp","add","displayName","time","toUTCString","audioUrl","child","put","url","getDownloadURL","id","update","audioInputChange","target","files","btnIcons","height","color","canRecord","navigator","mediaDevices","getUserMedia","window","MediaRecorder","trim","display"],"mappings":"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","sourcesContent":["import {\n  CancelRounded,\n  CheckCircleRounded,\n  MicRounded,\n  Send,\n} from \"@material-ui/icons\";\nimport React from \"react\";\nimport { createTimestamp, db, audioStorage } from \"../firebase\";\nimport { v4 as uuid } from \"uuid\";\nimport \"./ChatFooter.css\";\nimport recordAudio from \"./recordAudio\";\n\nexport default function ChatFooter({\n  input,\n  onChange,\n  sendMessage,\n  image,\n  user,\n  room,\n  roomId,\n  setAudioId,\n}) {\n  const [isRecording, setRecording] = React.useState(false);\n  const [duration, setDuration] = React.useState(\"00:00\");\n\n  const timerInterval = React.useRef();\n  const recordingEl = React.useRef();\n  const record = React.useRef();\n  const inputRef = React.useRef();\n\n  async function startRecording(event) {\n    event.preventDefault();\n    record.current = await recordAudio();\n    inputRef.current.focus();\n    inputRef.current.style.width = \"calc(100% - 56px)\";\n    setRecording(true);\n    setAudioId(\"\");\n  }\n\n  React.useEffect(() => {\n    if (isRecording) {\n      recordingEl.current.style.opacity = \"1\";\n      startTimer();\n      record.current.start();\n    }\n\n    function startTimer() {\n      const start = Date.now();\n      timerInterval.current = setInterval(setTime, 100);\n\n      function setTime() {\n        const timeElapsed = Date.now() - start;\n        const totalSeconds = Math.floor(timeElapsed / 1000);\n        const minutes = pad(parseInt(totalSeconds / 60));\n        const seconds = pad(parseInt(totalSeconds % 60));\n        const duration = `${minutes}:${seconds}`;\n        setDuration(duration);\n      }\n    }\n  }, [isRecording]);\n\n  function pad(value) {\n    return String(value).length < 2 ? `0${value}` : value;\n  }\n\n  async function stopRecording() {\n    inputRef.current.focus();\n    clearInterval(timerInterval.current);\n    const audio = record.current.stop();\n    recordingEl.current.style.opacity = \"0\";\n    setRecording(false);\n    inputRef.current.style.width = \"calc(100% - 112px)\";\n    setDuration(\"00:00\");\n    return audio;\n  }\n\n  async function finishRecording() {\n    const audio = await stopRecording();\n    const { audioFile, audioName } = await audio;\n    sendAudio(audioFile, audioName);\n  }\n\n  async function sendAudio(audioFile, audioName) {\n    db.collection(\"users\")\n      .doc(user.uid)\n      .collection(\"chats\")\n      .doc(roomId)\n      .set({\n        name: room.name,\n        photoURL: room.photoURL || null,\n        timestamp: createTimestamp(),\n      });\n\n    const doc = await db\n      .collection(\"rooms\")\n      .doc(roomId)\n      .collection(\"messages\")\n      .add({\n        name: user.displayName,\n        uid: user.uid,\n        timestamp: createTimestamp(),\n        time: new Date().toUTCString(),\n        audioUrl: \"uploading\",\n        audioName,\n      });\n\n    await audioStorage.child(audioName).put(audioFile);\n    const url = await audioStorage.child(audioName).getDownloadURL();\n    db.collection(\"rooms\")\n      .doc(roomId)\n      .collection(\"messages\")\n      .doc(doc.id)\n      .update({\n        audioUrl: url,\n      });\n  }\n\n  function audioInputChange(event) {\n    const audioFile = event.target.files[0];\n\n    if (audioFile) {\n      setAudioId(\"\");\n      sendAudio(audioFile, uuid());\n    }\n  }\n\n  const btnIcons = (\n    <>\n      <Send\n        style={{\n          width: 20,\n          height: 20,\n          color: \"white\",\n        }}\n      />\n      <MicRounded\n        style={{\n          width: 24,\n          height: 24,\n          color: \"white\",\n        }}\n      />\n    </>\n  );\n\n  const canRecord = navigator.mediaDevices.getUserMedia && window.MediaRecorder;\n\n  return (\n    <div className=\"chat__footer\">\n      <form>\n        <input\n          ref={inputRef}\n          value={input}\n          onChange={!isRecording ? onChange : null}\n          onKeyPress={isRecording ? () => false : null}\n          placeholder=\"Type a message\"\n        />\n\n        {canRecord ? (\n          <button\n            onClick={\n              input.trim() || (input === \"\" && image)\n                ? sendMessage\n                : startRecording\n            }\n            type=\"submit\"\n            className=\"send__btn\"\n          >\n            {btnIcons}\n          </button>\n        ) : (\n          <>\n            <label htmlFor=\"capture\" className=\"send__btn\">\n              {btnIcons}\n            </label>\n            <input\n              style={{ display: \"none\" }}\n              type=\"file\"\n              id=\"capture\"\n              accept=\"audio/*\"\n              capture\n              onChange={audioInputChange}\n            />\n          </>\n        )}\n      </form>\n\n      {isRecording && (\n        <div ref={recordingEl} className=\"record\">\n          <CancelRounded\n            style={{\n              width: 30,\n              height: 30,\n              color: \"#f20519\",\n            }}\n            onClick={stopRecording}\n          />\n          <div>\n            <div className=\"record__redcircle\" />\n            <div className=\"record__duration\">{duration}</div>\n          </div>\n          <CheckCircleRounded\n            style={{\n              width: 30,\n              height: 30,\n              color: \"#41bf49\",\n            }}\n            onClick={finishRecording}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}