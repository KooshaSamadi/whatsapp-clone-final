{"ast":null,"code":"import _slicedToArray from\"C:/Users/Koosha/Desktop/Reed Barger - Build WhatsApp with React 2021-5/whatsapp-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{CircularProgress}from\"@material-ui/core\";import{PauseRounded,PlayArrowRounded}from\"@material-ui/icons\";import React from\"react\";import\"./AudioPlayer.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function AudioPlayer(_ref){var sender=_ref.sender,audioUrl=_ref.audioUrl,id=_ref.id,setAudioId=_ref.setAudioId,audioId=_ref.audioId;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isPlaying=_React$useState2[0],setPlaying=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isMediaLoaded=_React$useState4[0],setMediaLoaded=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isLoaded=_React$useState6[0],setLoaded=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isMetadataLoaded=_React$useState8[0],setMetadataLoaded=_React$useState8[1];var _React$useState9=React.useState(0),_React$useState10=_slicedToArray(_React$useState9,2),sliderValue=_React$useState10[0],setSliderValue=_React$useState10[1];var _React$useState11=React.useState(\"\"),_React$useState12=_slicedToArray(_React$useState11,2),duration=_React$useState12[0],setDuration=_React$useState12[1];var totalDuration=React.useRef(\"\");var audio=React.useRef(new Audio(audioUrl));var interval=React.useRef();var isUploading=React.useRef(audioUrl===\"uploading\");React.useEffect(function(){if(isUploading.current&&audioUrl!==\"uploading\"){audio.current=new Audio(audioUrl);audio.current.load();setLoaded(true);}else if(isUploading.current===false){setLoaded(true);}},[audioUrl]);function getAudioDuration(media){return new Promise(function(resolve){media.onloadedmetadata=function(){media.currentTime=Number.MAX_SAFE_INTEGER;media.ontimeupdate=function(){media.ontimeupdate=function(){};media.currentTime=0.1;resolve(media.duration);};};});}React.useEffect(function(){if(isLoaded){getAudioDuration(audio.current).then(function(){setMetadataLoaded(true);});}},[isLoaded]);React.useEffect(function(){if(isMetadataLoaded){audio.current.addEventListener(\"canplaythrough\",function(){if(!totalDuration.current){setMediaLoaded(true);var time=formatTime(audio.current.duration);totalDuration.current=time;setDuration(totalDuration.current);}});audio.current.addEventListener(\"ended\",function(){clearInterval(interval.current);setDuration(totalDuration.current);setSliderValue(0);setPlaying(false);});}},[isMetadataLoaded]);function formatTime(time){var minutes=Math.floor(time/60);var seconds=Math.floor(time-minutes*60);if(minutes<10){minutes=\"0\".concat(minutes);}if(seconds<10){seconds=\"0\".concat(seconds);}return\"\".concat(minutes,\":\").concat(seconds);}function playAudio(){setPlaying(true);audio.current.play();if(audioId!==id){setAudioId(id);}interval.current=setInterval(updateSlider,100);}function updateSlider(){var sliderPosition=0;var _audio$current=audio.current,currentTime=_audio$current.currentTime,duration=_audio$current.duration;if(typeof duration===\"number\"){sliderPosition=currentTime*(100/duration);setSliderValue(sliderPosition);var time=formatTime(currentTime);setDuration(time);}}function stopAudio(){audio.current.pause();clearInterval(interval.current);setPlaying(false);setDuration(totalDuration.current);}function scrubAudio(event){var value=event.target.value;var duration=audio.current.duration;if(isMediaLoaded){var seekTo=duration*(value/100);audio.current.currentTime=seekTo;setSliderValue(value);}}React.useEffect(function(){if(audioId!==id){audio.current.pause();setPlaying(false);}},[audioId,id]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"audioplayer \".concat(sender?\"\":\"audioplayer__alt\"),children:[!isMediaLoaded?/*#__PURE__*/_jsx(CircularProgress,{}):isPlaying?/*#__PURE__*/_jsx(PauseRounded,{onClick:stopAudio,className:\"pause\"}):!isPlaying?/*#__PURE__*/_jsx(PlayArrowRounded,{onClick:playAudio}):null,/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{width:\"\".concat(sliderValue,\"%\")},className:\"audioplayer__slider--played\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"1\",max:\"100\",value:sliderValue,onChange:scrubAudio,className:\"audioplayer__slider\"})]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"chat__timestamp audioplayer__time\",children:duration})]});}","map":{"version":3,"sources":["C:/Users/Koosha/Desktop/Reed Barger - Build WhatsApp with React 2021-5/whatsapp-clone/src/components/AudioPlayer.js"],"names":["CircularProgress","PauseRounded","PlayArrowRounded","React","AudioPlayer","sender","audioUrl","id","setAudioId","audioId","useState","isPlaying","setPlaying","isMediaLoaded","setMediaLoaded","isLoaded","setLoaded","isMetadataLoaded","setMetadataLoaded","sliderValue","setSliderValue","duration","setDuration","totalDuration","useRef","audio","Audio","interval","isUploading","useEffect","current","load","getAudioDuration","media","Promise","resolve","onloadedmetadata","currentTime","Number","MAX_SAFE_INTEGER","ontimeupdate","then","addEventListener","time","formatTime","clearInterval","minutes","Math","floor","seconds","playAudio","play","setInterval","updateSlider","sliderPosition","stopAudio","pause","scrubAudio","event","value","target","seekTo","width"],"mappings":"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","sourcesContent":["import { CircularProgress } from \"@material-ui/core\";\nimport { PauseRounded, PlayArrowRounded } from \"@material-ui/icons\";\nimport React from \"react\";\nimport \"./AudioPlayer.css\";\n\nexport default function AudioPlayer({\n  sender,\n  audioUrl,\n  id,\n  setAudioId,\n  audioId,\n}) {\n  const [isPlaying, setPlaying] = React.useState(false);\n  const [isMediaLoaded, setMediaLoaded] = React.useState(false);\n  const [isLoaded, setLoaded] = React.useState(false);\n  const [isMetadataLoaded, setMetadataLoaded] = React.useState(false);\n  const [sliderValue, setSliderValue] = React.useState(0);\n  const [duration, setDuration] = React.useState(\"\");\n\n  const totalDuration = React.useRef(\"\");\n  const audio = React.useRef(new Audio(audioUrl));\n  const interval = React.useRef();\n  const isUploading = React.useRef(audioUrl === \"uploading\");\n\n  React.useEffect(() => {\n    if (isUploading.current && audioUrl !== \"uploading\") {\n      audio.current = new Audio(audioUrl);\n      audio.current.load();\n      setLoaded(true);\n    } else if (isUploading.current === false) {\n      setLoaded(true);\n    }\n  }, [audioUrl]);\n\n  function getAudioDuration(media) {\n    return new Promise((resolve) => {\n      media.onloadedmetadata = () => {\n        media.currentTime = Number.MAX_SAFE_INTEGER;\n\n        media.ontimeupdate = () => {\n          media.ontimeupdate = () => {};\n          media.currentTime = 0.1;\n          resolve(media.duration);\n        };\n      };\n    });\n  }\n\n  React.useEffect(() => {\n    if (isLoaded) {\n      getAudioDuration(audio.current).then(() => {\n        setMetadataLoaded(true);\n      });\n    }\n  }, [isLoaded]);\n\n  React.useEffect(() => {\n    if (isMetadataLoaded) {\n      audio.current.addEventListener(\"canplaythrough\", () => {\n        if (!totalDuration.current) {\n          setMediaLoaded(true);\n          const time = formatTime(audio.current.duration);\n          totalDuration.current = time;\n          setDuration(totalDuration.current);\n        }\n      });\n\n      audio.current.addEventListener(\"ended\", () => {\n        clearInterval(interval.current);\n        setDuration(totalDuration.current);\n        setSliderValue(0);\n        setPlaying(false);\n      });\n    }\n  }, [isMetadataLoaded]);\n\n  function formatTime(time) {\n    let minutes = Math.floor(time / 60);\n    let seconds = Math.floor(time - minutes * 60);\n\n    if (minutes < 10) {\n      minutes = `0${minutes}`;\n    }\n    if (seconds < 10) {\n      seconds = `0${seconds}`;\n    }\n\n    return `${minutes}:${seconds}`;\n  }\n\n  function playAudio() {\n    setPlaying(true);\n    audio.current.play();\n    if (audioId !== id) {\n      setAudioId(id);\n    }\n    interval.current = setInterval(updateSlider, 100);\n  }\n\n  function updateSlider() {\n    let sliderPosition = 0;\n\n    const { currentTime, duration } = audio.current;\n    if (typeof duration === \"number\") {\n      sliderPosition = currentTime * (100 / duration);\n      setSliderValue(sliderPosition);\n      const time = formatTime(currentTime);\n      setDuration(time);\n    }\n  }\n\n  function stopAudio() {\n    audio.current.pause();\n    clearInterval(interval.current);\n    setPlaying(false);\n    setDuration(totalDuration.current);\n  }\n\n  function scrubAudio(event) {\n    const value = event.target.value;\n    const { duration } = audio.current;\n\n    if (isMediaLoaded) {\n      const seekTo = duration * (value / 100);\n      audio.current.currentTime = seekTo;\n      setSliderValue(value);\n    }\n  }\n\n  React.useEffect(() => {\n    if (audioId !== id) {\n      audio.current.pause();\n      setPlaying(false);\n    }\n  }, [audioId, id]);\n\n  return (\n    <>\n      <div className={`audioplayer ${sender ? \"\" : \"audioplayer__alt\"}`}>\n        {!isMediaLoaded ? (\n          <CircularProgress />\n        ) : isPlaying ? (\n          <PauseRounded onClick={stopAudio} className=\"pause\" />\n        ) : !isPlaying ? (\n          <PlayArrowRounded onClick={playAudio} />\n        ) : null}\n        <div>\n          <span\n            style={{ width: `${sliderValue}%` }}\n            className=\"audioplayer__slider--played\"\n          />\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"100\"\n            value={sliderValue}\n            onChange={scrubAudio}\n            className=\"audioplayer__slider\"\n          />\n        </div>\n      </div>\n      <span className=\"chat__timestamp audioplayer__time\">{duration}</span>\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}